// Generated by CoffeeScript 1.10.0
(function() {
  $(function() {
    $.ajaxSetup({
      beforeSend: function(xhr, settings) {
        var getCookie;
        getCookie = function(name) {
          var cookie, cookieValue, cookies, i;
          cookieValue = null;
          if (document.cookie && document.cookie !== '') {
            cookies = document.cookie.split(';');
            i = 0;
            while (i < cookies.length) {
              cookie = jQuery.trim(cookies[i]);
              if (cookie.substring(0, name.length + 1) === name + '=') {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
              }
              i++;
            }
          }
          return cookieValue;
        };
        if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
          xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));
        }
      }
    });
    $('form#verify-auth').on('click', '.toggle-verify-auth-btn', function() {
      if ($('.verify-auth-block').is(':visible')) {
        $('.verify-auth-block').slideUp();
      } else {
        $('.verify-auth-block').slideDown();
      }
    });
    return $('form#verify-auth').submit(function(e) {
      console.log('Verifying authentication');
      $('.verify-auth-btn').html('Verifying...');
      $.ajax({
        type: 'POST',
        url: '/cl/verify_auth',
        data: {
          email: $('#cl_email').val(),
          pass: $('#cl_password').val()
        },
        dataType: 'json'
      }).done(function(data) {
        var accountId;
        console.log('success');
        console.log(data);
        accountId = data.account_id;
        $('#cl_account_num').html(accountId);
        $('#cl_account_num_input').val(accountId);
        if (data.success === false) {
          alert(data.error);
          $('#cl_account_num').html(data.error);
        } else {
          $('.verify-auth-block').slideUp();
          $('.show-verify-auth-btn').slideDown();
          $('form#post-job').slideDown();
        }
      }).fail(function(data, textStatus, errorThrown) {
        console.log('fail');
        console.log(data);
      }).always(function(data, textStatus, errorThrown) {
        $('.verify-auth-btn').html('Verify Credentials');
        console.log('always');
        console.log(textStatus);
        console.log(errorThrown);
      });
      e.preventDefault(e);
    });
  });

}).call(this);
